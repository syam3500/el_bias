N_extractables <- 80
for (m_name in names(UF_list)) {
uf_val <- UF_list[[m_name]]
total_FN <- 0
total_FP <- 0
total_TP <- 0
total_TN <- 0
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- runif(N_extractables, min = 0.5 * AET, max = 2 * AET)
## A) Sampling from the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"10 µg/mL", size = N_extractables, replace = FALSE)
## II) UF corrections
exp_conc <- (base_conc_sim * simulated_RRF)
corrected_conc <- exp_conc * uf_val
is_above_threshold <- base_conc_sim > AET
reported_above_threshold <- corrected_conc > AET
iter_TP <- sum(is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FP <- sum(!is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FN <- sum(is_above_threshold & !reported_above_threshold, na.rm = TRUE)
iter_TN <- sum(!is_above_threshold & !reported_above_threshold, na.rm = TRUE)
total_TP <- total_TP + iter_TP
total_FP <- total_FP + iter_FP
total_FN <- total_FN + iter_FN
total_TN <- total_TN + iter_TN
# metrics per iterations
iter_prec <- if((iter_TP + iter_FP) > 0) iter_TP / (iter_TP + iter_FP) else 0
iter_rec  <- if((iter_TP + iter_FN) > 0) iter_TP / (iter_TP + iter_FN) else 0
iter_ActualPos <- iter_TP + iter_FN
iter_ActualNeg <- iter_TN + iter_FP
iter_fnr <- if(iter_ActualPos > 0) iter_FN / iter_ActualPos else 0
iter_fpr <- if(iter_ActualNeg > 0) iter_FP / iter_ActualNeg else 0
dist_fnr[i] <- iter_fnr * 100
dist_fpr[i] <- iter_fpr * 100
# F1
iter_f1 <- if((iter_prec + iter_rec) > 0) {
(2 * iter_prec * iter_rec) / (iter_prec + iter_rec)
} else { 0 }
# F5
denom_beta <- (beta^2 * iter_prec) + iter_rec
iter_fbeta <- if(denom_beta > 0) {
((1 + beta^2) * (iter_prec * iter_rec)) / denom_beta
} else { 0 }
dist_f1[i]   <- iter_f1
dist_f5[i]   <- iter_fbeta
}
count_Above_AET <- total_TP + total_FN
count_Below_AET  <- total_TN + total_FP
FN_Rate_final <- total_FN / count_Above_AET
FP_Rate_final <- total_FP / count_Below_AET
recall <- total_TP / count_Above_AET
precision <- total_TP / (total_TP + total_FP)
F1 <- (2 * precision * recall / (precision + recall))
beta <- 5
f_beta <- (1 + beta^2) * (precision * recall) / ((beta^2 * precision) + recall)
SD_FN <- sqrt(FN_Rate_final * (1 - FN_Rate_final) / count_Above_AET)
SD_FP <- sqrt(FP_Rate_final * (1 - FP_Rate_final) / count_Below_AET)
summary_table <- rbind(summary_table, data.frame(
Method = m_name,
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = SD_FN,
FP_SD = SD_FP,
precision = precision,
recall = recall,
F1 = F1,
f_beta = f_beta
))
metrics_df <- data.frame(
Method = m_name,
F1 = dist_f1,
F5 = dist_f5,
Percent_FN = dist_fnr,
Percent_FP = dist_fpr
)
all_distributions <- rbind(all_distributions, metrics_df)}
UF_RSD
summary_table
percentile <- function(x) {
return(quantile(x, .16))
}
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_TP <- 0
total_TN <- 0
RRF_GCMS_superior0 <- gcms_clap_clean$"10 µg/mL"
RRF_GCMS_superior0 <- RRF_GCMS_superior0[RRF_GCMS_superior0 > 0]
meanGCMS <- mean(RRF_GCMS_superior0)
percentileGCMS <- percentile(RRF_GCMS_superior0)
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- runif(N_extractables, min = 0.5 * AET, max = 2 * AET)
## A) Sampling from the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"10 µg/mL", size = N_extractables, replace = FALSE)
exp_conc <- (base_conc_sim * simulated_RRF)
## III) 16th percentile Correction
corrected_conc <- exp_conc * (meanGCMS / percentileGCMS)
is_above_threshold <- base_conc_sim > AET
reported_above_threshold <- corrected_conc > AET
iter_TP <- sum(is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FP <- sum(!is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FN <- sum(is_above_threshold & !reported_above_threshold, na.rm = TRUE)
iter_TN <- sum(!is_above_threshold & !reported_above_threshold, na.rm = TRUE)
total_TP <- total_TP + iter_TP
total_FP <- total_FP + iter_FP
total_FN <- total_FN + iter_FN
total_TN <- total_TN + iter_TN
# metrics per iterations
iter_prec <- if((iter_TP + iter_FP) > 0) iter_TP / (iter_TP + iter_FP) else 0
iter_rec  <- if((iter_TP + iter_FN) > 0) iter_TP / (iter_TP + iter_FN) else 0
iter_ActualPos <- iter_TP + iter_FN
iter_ActualNeg <- iter_TN + iter_FP
iter_fnr <- if(iter_ActualPos > 0) iter_FN / iter_ActualPos else 0
iter_fpr <- if(iter_ActualNeg > 0) iter_FP / iter_ActualNeg else 0
dist_fnr[i] <- iter_fnr * 100
dist_fpr[i] <- iter_fpr * 100
# F1
iter_f1 <- if((iter_prec + iter_rec) > 0) {
(2 * iter_prec * iter_rec) / (iter_prec + iter_rec)
} else { 0 }
# F5
denom_beta <- (beta^2 * iter_prec) + iter_rec
iter_fbeta <- if(denom_beta > 0) {
((1 + beta^2) * (iter_prec * iter_rec)) / denom_beta
} else { 0 }
dist_f1[i]   <- iter_f1
dist_f5[i]   <- iter_fbeta
}
count_Above_AET <- total_TP + total_FN
count_Below_AET  <- total_TN + total_FP
FN_Rate_final <- total_FN / count_Above_AET
FP_Rate_final <- total_FP / count_Below_AET
recall <- total_TP / count_Above_AET
precision <- total_TP / (total_TP + total_FP)
F1 <- (2 * precision * recall / (precision + recall))
beta <- 5
f_beta <- (1 + beta^2) * (precision * recall) / ((beta^2 * precision) + recall)
SD_FN <- sqrt(FN_Rate_final * (1 - FN_Rate_final) / count_Above_AET)
SD_FP <- sqrt(FP_Rate_final * (1 - FP_Rate_final) / count_Below_AET)
summary_table <- rbind(summary_table, data.frame(
Method = "Mean/Percentile (16th)",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = SD_FN,
FP_SD = SD_FP,
precision = precision,
recall = recall,
F1 = F1,
f_beta = f_beta
))
metrics_df <- data.frame(
Method = "Mean/Percentile (16th)",
F1 = dist_f1,
F5 = dist_f5,
Percent_FN = dist_fnr,
Percent_FP = dist_fpr
)
all_distributions <- rbind(all_distributions, metrics_df)
## RSD is calculated only for RRFs between 0.05 and 1
## 'Compounds with RRF lower than 0.05 are excluded from UF calculation (20 times lower than the internal standard).page 8
## Therefore, as a criterion for RRF selection, only compounds with an RRF less than 1 are actually considered for UF calculation. page 8
rsd <- function(x) {
x_use = x[x<=1&x>0.05]
return(sd(x_use, na.rm = TRUE) / mean(x_use, na.rm = TRUE))
}
## Simulation starts
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_TP <- 0
total_TN <- 0
# remove 0 values
RRF_GCMS_superior0 <- gcms_clap_clean$"10 µg/mL"
RRF_GCMS_superior0 <- RRF_GCMS_superior0[RRF_GCMS_superior0 > 0]
# Apply Part 18 formula for database
UF <- 1/(1-rsd(RRF_GCMS_superior0))
# Start simulation
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- runif(N_extractables, min = 0.5 * AET, max = 2 * AET)
## A) Sampling from the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"10 µg/mL", size = N_extractables, replace = FALSE)
## IV) RRflow condition
## add a normal / lognormal distribution to get a "exp" RRF with some variability e.g 30%
exp_RRF <- simulated_RRF * rnorm(n = N_extractables, 1, 0.3)
exp_conc <- base_conc_sim * simulated_RRF   # experimental concentration : True concentration with the actual RRF
corrected_conc <- exp_conc * UF             # corrected concentration: Exp * UF (conservative method)
condition <- (simulated_RRF < 0.5) | (simulated_RRF > 2) # RRFlow conditions rescaling factor should be focused only to those compounds which exhibits RRF< 0.5 and RRF>2
corrected_conc[condition] <- exp_conc[condition] / exp_RRF[condition] # average value of the RRF RRFlow application in extractables amount rescaling ( The average RRF determined by the RRFlow will be used to re-calculate the amount of the corresponding compound detected in the extractables study , will assume that it is in the linearity range)
is_above_threshold <- base_conc_sim > AET
reported_above_threshold <- corrected_conc > AET
iter_TP <- sum(is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FP <- sum(!is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FN <- sum(is_above_threshold & !reported_above_threshold, na.rm = TRUE)
iter_TN <- sum(!is_above_threshold & !reported_above_threshold, na.rm = TRUE)
total_TP <- total_TP + iter_TP
total_FP <- total_FP + iter_FP
total_FN <- total_FN + iter_FN
total_TN <- total_TN + iter_TN
# metrics per iterations
iter_prec <- if((iter_TP + iter_FP) > 0) iter_TP / (iter_TP + iter_FP) else 0
iter_rec  <- if((iter_TP + iter_FN) > 0) iter_TP / (iter_TP + iter_FN) else 0
iter_ActualPos <- iter_TP + iter_FN
iter_ActualNeg <- iter_TN + iter_FP
iter_fnr <- if(iter_ActualPos > 0) iter_FN / iter_ActualPos else 0
iter_fpr <- if(iter_ActualNeg > 0) iter_FP / iter_ActualNeg else 0
dist_fnr[i] <- iter_fnr * 100
dist_fpr[i] <- iter_fpr * 100
# F1
iter_f1 <- if((iter_prec + iter_rec) > 0) {
(2 * iter_prec * iter_rec) / (iter_prec + iter_rec)
} else { 0 }
# F5
denom_beta <- (beta^2 * iter_prec) + iter_rec
iter_fbeta <- if(denom_beta > 0) {
((1 + beta^2) * (iter_prec * iter_rec)) / denom_beta
} else { 0 }
dist_f1[i]   <- iter_f1
dist_f5[i]   <- iter_fbeta
}
count_Above_AET <- total_TP + total_FN
count_Below_AET  <- total_TN + total_FP
FN_Rate_final <- total_FN / count_Above_AET
FP_Rate_final <- total_FP / count_Below_AET
recall <- total_TP / count_Above_AET
precision <- total_TP / (total_TP + total_FP)
F1 <- (2 * precision * recall / (precision + recall))
beta <- 5
f_beta <- (1 + beta^2) * (precision * recall) / ((beta^2 * precision) + recall)
SD_FN <- sqrt(FN_Rate_final * (1 - FN_Rate_final) / count_Above_AET)
SD_FP <- sqrt(FP_Rate_final * (1 - FP_Rate_final) / count_Below_AET)
summary_table <- rbind(summary_table, data.frame(
Method = "RRFlow",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = SD_FN,
FP_SD = SD_FP,
precision = precision,
recall = recall,
F1 = F1,
f_beta = f_beta
))
metrics_df <- data.frame(
Method = "RRFlow",
F1 = dist_f1,
F5 = dist_f5,
Percent_FN = dist_fnr,
Percent_FP = dist_fpr
)
all_distributions <- rbind(all_distributions, metrics_df)
## RSD is calculated only for RRFs between 0.05 and 1
## 'Compounds with RRF lower than 0.05 are excluded from UF calculation (20 times lower than the internal standard).page 8
## Therefore, as a criterion for RRF selection, only compounds with an RRF less than 1 are actually considered for UF calculation. page 8
rsd <- function(x) {
x_use = x[x<=1&x>0.05]
return(sd(x_use, na.rm = TRUE) / mean(x_use, na.rm = TRUE))
}
## Simulation starts
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_TP <- 0
total_TN <- 0
# remove 0 values
RRF_GCMS_superior0 <- gcms_clap_clean$"10 µg/mL"
RRF_GCMS_superior0 <- RRF_GCMS_superior0[RRF_GCMS_superior0 > 0]
# Apply Part 18 formula for database
UF <- 1/(1-rsd(RRF_GCMS_superior0))
# Start simulation
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- runif(N_extractables, min = 0.5 * AET, max = 2 * AET)
## A) Sampling from the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"10 µg/mL", size = N_extractables, replace = FALSE)
## IV) RRflow condition
## add a normal / lognormal distribution to get a "exp" RRF with some variability e.g 30%
exp_RRF <- simulated_RRF * rnorm(n = N_extractables, 1, 0.3)
exp_conc <- base_conc_sim * simulated_RRF   # experimental concentration : True concentration with the actual RRF
corrected_conc <- exp_conc * UF             # corrected concentration: Exp * UF (conservative method)
condition <- (simulated_RRF < 1)  # Condition only for LOW responders
corrected_conc[condition] <- exp_conc[condition] / exp_RRF[condition] # average value of the RRF RRFlow application in extractables amount rescaling ( The average RRF determined by the RRFlow will be used to re-calculate the amount of the corresponding compound detected in the extractables study , will assume that it is in the linearity range)
is_above_threshold <- base_conc_sim > AET
reported_above_threshold <- corrected_conc > AET
iter_TP <- sum(is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FP <- sum(!is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FN <- sum(is_above_threshold & !reported_above_threshold, na.rm = TRUE)
iter_TN <- sum(!is_above_threshold & !reported_above_threshold, na.rm = TRUE)
total_TP <- total_TP + iter_TP
total_FP <- total_FP + iter_FP
total_FN <- total_FN + iter_FN
total_TN <- total_TN + iter_TN
# metrics per iterations
iter_prec <- if((iter_TP + iter_FP) > 0) iter_TP / (iter_TP + iter_FP) else 0
iter_rec  <- if((iter_TP + iter_FN) > 0) iter_TP / (iter_TP + iter_FN) else 0
iter_ActualPos <- iter_TP + iter_FN
iter_ActualNeg <- iter_TN + iter_FP
iter_fnr <- if(iter_ActualPos > 0) iter_FN / iter_ActualPos else 0
iter_fpr <- if(iter_ActualNeg > 0) iter_FP / iter_ActualNeg else 0
dist_fnr[i] <- iter_fnr * 100
dist_fpr[i] <- iter_fpr * 100
# F1
iter_f1 <- if((iter_prec + iter_rec) > 0) {
(2 * iter_prec * iter_rec) / (iter_prec + iter_rec)
} else { 0 }
# F5
denom_beta <- (beta^2 * iter_prec) + iter_rec
iter_fbeta <- if(denom_beta > 0) {
((1 + beta^2) * (iter_prec * iter_rec)) / denom_beta
} else { 0 }
dist_f1[i]   <- iter_f1
dist_f5[i]   <- iter_fbeta
}
count_Above_AET <- total_TP + total_FN
count_Below_AET  <- total_TN + total_FP
FN_Rate_final <- total_FN / count_Above_AET
FP_Rate_final <- total_FP / count_Below_AET
recall <- total_TP / count_Above_AET
precision <- total_TP / (total_TP + total_FP)
F1 <- (2 * precision * recall / (precision + recall))
beta <- 5
f_beta <- (1 + beta^2) * (precision * recall) / ((beta^2 * precision) + recall)
SD_FN <- sqrt(FN_Rate_final * (1 - FN_Rate_final) / count_Above_AET)
SD_FP <- sqrt(FP_Rate_final * (1 - FP_Rate_final) / count_Below_AET)
summary_table <- rbind(summary_table, data.frame(
Method = "RRF<1",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = SD_FN,
FP_SD = SD_FP,
precision = precision,
recall = recall,
F1 = F1,
f_beta = f_beta
))
metrics_df <- data.frame(
Method = "RRF<1",
F1 = dist_f1,
F5 = dist_f5,
Percent_FN = dist_fnr,
Percent_FP = dist_fpr
)
all_distributions <- rbind(all_distributions, metrics_df)
UF
summary_table
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_TP <- 0
total_TN <- 0
RRF_GCMS_superior0 <- gcms_clap_clean$"10 µg/mL"
RRF_GCMS_superior0 <- RRF_GCMS_superior0[RRF_GCMS_superior0 > 0]
conservative_RRF_estimate <- quantile(gcms_clap_clean$"10 µg/mL", 0.10)
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- runif(N_extractables, min = 0.5 * AET, max = 2 * AET)
## A) Sampling from the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"10 µg/mL", size = N_extractables, replace = FALSE)
## V
exp_conc <- base_conc_sim * simulated_RRF   # experimental concentration : True concentration with the actual RRF
corrected_conc <- exp_conc / conservative_RRF_estimate ## need to find rationale
is_above_threshold <- base_conc_sim > AET
reported_above_threshold <- corrected_conc > AET
iter_TP <- sum(is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FP <- sum(!is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FN <- sum(is_above_threshold & !reported_above_threshold, na.rm = TRUE)
iter_TN <- sum(!is_above_threshold & !reported_above_threshold, na.rm = TRUE)
total_TP <- total_TP + iter_TP
total_FP <- total_FP + iter_FP
total_FN <- total_FN + iter_FN
total_TN <- total_TN + iter_TN
# metrics per iterations
iter_prec <- if((iter_TP + iter_FP) > 0) iter_TP / (iter_TP + iter_FP) else 0
iter_rec  <- if((iter_TP + iter_FN) > 0) iter_TP / (iter_TP + iter_FN) else 0
iter_ActualPos <- iter_TP + iter_FN
iter_ActualNeg <- iter_TN + iter_FP
iter_fnr <- if(iter_ActualPos > 0) iter_FN / iter_ActualPos else 0
iter_fpr <- if(iter_ActualNeg > 0) iter_FP / iter_ActualNeg else 0
dist_fnr[i] <- iter_fnr * 100
dist_fpr[i] <- iter_fpr * 100
# F1
iter_f1 <- if((iter_prec + iter_rec) > 0) {
(2 * iter_prec * iter_rec) / (iter_prec + iter_rec)
} else { 0 }
# F5
denom_beta <- (beta^2 * iter_prec) + iter_rec
iter_fbeta <- if(denom_beta > 0) {
((1 + beta^2) * (iter_prec * iter_rec)) / denom_beta
} else { 0 }
dist_f1[i]   <- iter_f1
dist_f5[i]   <- iter_fbeta
}
count_Above_AET <- total_TP + total_FN
count_Below_AET  <- total_TN + total_FP
FN_Rate_final <- total_FN / count_Above_AET
FP_Rate_final <- total_FP / count_Below_AET
recall <- total_TP / count_Above_AET
precision <- total_TP / (total_TP + total_FP)
F1 <- (2 * precision * recall / (precision + recall))
beta <- 5
f_beta <- (1 + beta^2) * (precision * recall) / ((beta^2 * precision) + recall)
SD_FN <- sqrt(FN_Rate_final * (1 - FN_Rate_final) / count_Above_AET)
SD_FP <- sqrt(FP_Rate_final * (1 - FP_Rate_final) / count_Below_AET)
summary_table <- rbind(summary_table, data.frame(
Method = "Percentile 10th",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = SD_FN,
FP_SD = SD_FP,
precision = precision,
recall = recall,
F1 = F1,
f_beta = f_beta
))
metrics_df <- data.frame(
Method = "Percentile 10th",
F1 = dist_f1,
F5 = dist_f5,
Percent_FN = dist_fnr,
Percent_FP = dist_fpr
)
all_distributions <- rbind(all_distributions, metrics_df)
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_TP <- 0
total_TN <- 0
RRF_GCMS_superior0 <- gcms_clap_clean$"10 µg/mL"
RRF_GCMS_superior0 <- RRF_GCMS_superior0[RRF_GCMS_superior0 > 0]
conservative_RRF_estimate <- quantile(gcms_clap_clean$"10 µg/mL", 0.20)
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- runif(N_extractables, min = 0.5 * AET, max = 2 * AET)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"10 µg/mL", size = N_extractables, replace = FALSE)
## V
exp_conc <- base_conc_sim * simulated_RRF   # experimental concentration : True concentration with the actual RRF
corrected_conc <- exp_conc / conservative_RRF_estimate ## need to find rationale
is_above_threshold <- base_conc_sim > AET
reported_above_threshold <- corrected_conc > AET
iter_TP <- sum(is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FP <- sum(!is_above_threshold & reported_above_threshold, na.rm = TRUE)
iter_FN <- sum(is_above_threshold & !reported_above_threshold, na.rm = TRUE)
iter_TN <- sum(!is_above_threshold & !reported_above_threshold, na.rm = TRUE)
total_TP <- total_TP + iter_TP
total_FP <- total_FP + iter_FP
total_FN <- total_FN + iter_FN
total_TN <- total_TN + iter_TN
# metrics per iterations
iter_prec <- if((iter_TP + iter_FP) > 0) iter_TP / (iter_TP + iter_FP) else 0
iter_rec  <- if((iter_TP + iter_FN) > 0) iter_TP / (iter_TP + iter_FN) else 0
iter_ActualPos <- iter_TP + iter_FN
iter_ActualNeg <- iter_TN + iter_FP
iter_fnr <- if(iter_ActualPos > 0) iter_FN / iter_ActualPos else 0
iter_fpr <- if(iter_ActualNeg > 0) iter_FP / iter_ActualNeg else 0
dist_fnr[i] <- iter_fnr * 100
dist_fpr[i] <- iter_fpr * 100
# F1
iter_f1 <- if((iter_prec + iter_rec) > 0) {
(2 * iter_prec * iter_rec) / (iter_prec + iter_rec)
} else { 0 }
# F5
denom_beta <- (beta^2 * iter_prec) + iter_rec
iter_fbeta <- if(denom_beta > 0) {
((1 + beta^2) * (iter_prec * iter_rec)) / denom_beta
} else { 0 }
dist_f1[i]   <- iter_f1
dist_f5[i]   <- iter_fbeta
}
count_Above_AET <- total_TP + total_FN
count_Below_AET  <- total_TN + total_FP
FN_Rate_final <- total_FN / count_Above_AET
FP_Rate_final <- total_FP / count_Below_AET
recall <- total_TP / count_Above_AET
precision <- total_TP / (total_TP + total_FP)
F1 <- (2 * precision * recall / (precision + recall))
beta <- 5
f_beta <- (1 + beta^2) * (precision * recall) / ((beta^2 * precision) + recall)
SD_FN <- sqrt(FN_Rate_final * (1 - FN_Rate_final) / count_Above_AET)
SD_FP <- sqrt(FP_Rate_final * (1 - FP_Rate_final) / count_Below_AET)
summary_table <- rbind(summary_table, data.frame(
Method = "Percentile 20th",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = SD_FN,
FP_SD = SD_FP,
precision = precision,
recall = recall,
F1 = F1,
f_beta = f_beta
))
metrics_df <- data.frame(
Method = "Percentile 20th",
F1 = dist_f1,
F5 = dist_f5,
Percent_FN = dist_fnr,
Percent_FP = dist_fpr
)
all_distributions <- rbind(all_distributions, metrics_df)
summary_table
print(summary_table)
reticulate::repl_python()

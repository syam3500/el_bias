hist(base_concentrations1)
set.seed(123)
base_concentrations2 <- rlnorm(100, meanlog = -1.15, sdlog = 1.91)
hist(base_concentrations2)
set.seed(123)
Z <- runif(70, min = 0.001, max = 1)
Y <- runif(20, min = 1, max = 10)
K <- runif(10, min = 10, max = 100)
custom <- c(Z, Y, K)
custom_sampled <- sample(custom, size = 100, replace = FALSE)
hist(custom_sampled)
set.seed(123)
RRF_norm <- rnorm(50, 1, 0.2)
RRF_norm[RRF_norm<0] <- 0.001 # avoiding negative numbers
hist(RRF_norm)
set.seed(123)
RRF_lnorm <- rlnorm(50, 0, 0.5)
RRF_lnorm[RRF_lnorm<0] <- 0.001 # avoiding negative numbers
hist(RRF_lnorm)
summary_table <- data.frame(
Method = character(),
FN_Rate = numeric(),
FP_Rate = numeric(),
FN_SD = numeric(),
FP_SD = numeric(),
CI_FN_Lower = numeric(),
CI_FN_Upper = numeric(),
CI_FP_Lower = numeric(),
CI_FP_Upper = numeric()
)
set.seed(123)
N_sim <- 10000
N_extractables <- 80
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_extractables, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_extractables, replace = FALSE)
## alpha) No Correction
corrected_conc <- base_conc_sim * simulated_RRF
FN <- (base_conc_sim > AET) & (corrected_conc < AET)
FP <- (base_conc_sim < AET) & (corrected_conc > AET)
}
summary_table <- rbind(summary_table, data.frame(
Method = "No Correction",
FN_Rate = sum(FN)/N_sim,
FP_Rate = sum(FP)/N_sim,
FN_SD = sqrt(FN_Rate*(1-FN_Rate)/N_sim),
FP_SD = sqrt(FP_Rate*(1-FP_Rate)/N_sim),
CI_FN_Lower = FN_Rate - 1.96*FN_SD,
CI_FN_Lower = FN_Rate + 1.96*FN_SD,
CI_FP_Lower = FP_Rate - 1.96*FP_SD,
CI_FP_Lower = FP_Rate + 1.96*FP_SD,
))
hist(base_conc_sim,
main = "Histogram of Base concentration around the AET",
xlab = "Concentration",
col = "skyblue")
hist(simulated_RRF,
main = "Histogram of RRFs (non-parametric bootstrap of GC/MS dataset 5µg/mL) from FDA Clap list",
xlab = "Concentration",
col = "grey")
rsd <- function(x) {
return(sd(x, na.rm = TRUE) / mean(x, na.rm = TRUE))
}
set.seed(123)
N_sim <- 10000
UF_RSD <- 1/(1-rsd(simulated_RRF)) # formula from ISO 10993-18
UF <- c(2, 4, 5, 10, UF_RSD)
N_extractables <- 80
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_extractables, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_extractables, replace = FALSE)
## beta) UF corrections
results_df <- data.frame(UF = numeric(), FN_Rate = numeric(), FP_Rate = numeric())
for (uf_val in UF) {
corrected_conc_uf <- (base_conc_sim * simulated_RRF) * uf_val
FN_loop <- (base_conc_sim > AET) & (corrected_conc_uf < AET)
FP_loop <- (base_conc_sim < AET) & (corrected_conc_uf > AET)
method_name <- ifelse(uf_val == UF_RSD, "UF (RSD)", paste0("UF (", round(uf_val, 1), ")"))
}
}
summary_table <- rbind(summary_table, data.frame(
Method = method_name,
FN_Rate = sum(FN)/N_sim,
FP_Rate = sum(FP)/N_sim,
FN_SD = sqrt(FN_Rate*(1-FN_Rate)/N_sim),
FP_SD = sqrt(FP_Rate*(1-FP_Rate)/N_sim),
CI_FN_Lower = FN_Rate - 1.96*FN_SD,
CI_FN_Lower = FN_Rate + 1.96*FN_SD,
CI_FP_Lower = FP_Rate - 1.96*FP_SD,
CI_FP_Lower = FP_Rate + 1.96*FP_SD,
))
UF_RSD
percentile <- function(x) {
return(quantile(x, .16))
}
set.seed(123)
N_sim <- 10000
N_extractables <- 80
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_sim, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_sim, replace = TRUE)
## gamma) 16th percentile Correction
corrected_conc <- base_conc_sim * simulated_RRF /  percentile(simulated_RRF)
FN <- (base_conc_sim > AET) & (corrected_conc < AET)
FP <- (base_conc_sim < AET) & (corrected_conc > AET)
}
summary_table <- rbind(summary_table, data.frame(
Method = "Percentile (16th)",
FN_Rate = sum(FN)/N_sim,
FP_Rate = sum(FP)/N_sim,
FN_SD = sqrt(FN_Rate*(1-FN_Rate)/N_sim),
FP_SD = sqrt(FP_Rate*(1-FP_Rate)/N_sim),
CI_FN_Lower = FN_Rate - 1.96*FN_SD,
CI_FN_Lower = FN_Rate + 1.96*FN_SD,
CI_FP_Lower = FP_Rate - 1.96*FP_SD,
CI_FP_Lower = FP_Rate + 1.96*FP_SD,
))
set.seed(123)
N_sim <- 10000
N_extractables <- 80
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_sim, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_sim, replace = TRUE)
## delta) RRflow condition
corrected_conc <- base_conc_sim
condition <- (simulated_RRF < 0.5) | (simulated_RRF > 2)
corrected_conc[condition] <- corrected_conc[condition] / simulated_RRF[condition]
FN <- (base_conc_sim > AET) & (corrected_conc < AET)
FP <- (base_conc_sim < AET) & (corrected_conc > AET)
}
summary_table <- rbind(summary_table, data.frame(
Method = "RRFlow",
FN_Rate = sum(FN)/N_sim,
FP_Rate = sum(FP)/N_sim,
FN_SD = sqrt(FN_Rate*(1-FN_Rate)/N_sim),
FP_SD = sqrt(FP_Rate*(1-FP_Rate)/N_sim),
CI_FN_Lower = FN_Rate - 1.96*FN_SD,
CI_FN_Lower = FN_Rate + 1.96*FN_SD,
CI_FP_Lower = FP_Rate - 1.96*FP_SD,
CI_FP_Lower = FP_Rate + 1.96*FP_SD,
))
set.seed(123)
N_sim <- 10000
N_extractables <- 80
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_sim, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_sim, replace = TRUE)
## epsilon RRF < 1
corrected_conc <- base_conc_sim
condition <- (simulated_RRF < 1)
corrected_conc[condition] <- corrected_conc[condition] / simulated_RRF[condition]
FN <- (base_conc_sim > AET) & (corrected_conc < AET)
FP <- (base_conc_sim < AET) & (corrected_conc > AET)
}
summary_table <- rbind(summary_table, data.frame(
Method = "RRF<1",
FN_Rate = sum(FN)/N_sim,
FP_Rate = sum(FP)/N_sim,
FN_SD = sqrt(FN_Rate*(1-FN_Rate)/N_sim),
FP_SD = sqrt(FP_Rate*(1-FP_Rate)/N_sim),
CI_FN_Lower = FN_Rate - 1.96*FN_SD,
CI_FN_Lower = FN_Rate + 1.96*FN_SD,
CI_FP_Lower = FP_Rate - 1.96*FP_SD,
CI_FP_Lower = FP_Rate + 1.96*FP_SD,
))
summary_table
reticulate::repl_python()
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_points <- N_sim * N_extractables
for (i in 1:N_sim) {
sim_data <- data.frame(
BP = rnorm(N_extractables, 359, 15),
`Refractive Index` = rnorm(N_extractables, 1.52, 0.01),
TPSA = rnorm(N_extractables, 44, 5),
NHOHCount = sample(0:4, N_extractables, replace=TRUE),
NOCount = sample(0:12, N_extractables, replace=TRUE),
NumHDonors = sample(0:4, N_extractables, replace=TRUE),
NumRotatableBonds = sample(0:35, N_extractables, replace=TRUE), check.names = FALSE)
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_extractables, replace = TRUE)
## E) RRF generated via the machine learning
simulated_RRF <- py$predict_rrf_raw(sim_data)
## no correction
corrected_conc <- base_conc_sim * simulated_RRF
total_FN <- total_FN + sum((base_conc_sim > AET) & (corrected_conc < AET))
total_FP <- total_FP + sum((base_conc_sim < AET) & (corrected_conc > AET))
}
FN_Rate_final <- total_FN / total_points
FP_Rate_final <- total_FP / total_points
summary_table <- rbind(summary_table, data.frame(
Method = "Machine Learning",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
FP_SD = sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FN_Lower = FN_Rate_final - 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FN_Upper = FN_Rate_final + 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FP_Lower = FP_Rate_final - 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FP_Upper = FP_Rate_final + 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points)
))
plot_data <- summary_table %>%
pivot_longer(cols = c(FN_Rate, FP_Rate), names_to = "Type", values_to = "Rate") %>%
mutate(
SD = ifelse(Type == "FN_Rate", round(FN_SD, 2), round(FP_SD, 2)),
Type = ifelse(Type == "FN_Rate", "False Negative", "False Positive")
)
method_levels <- c(
"No Correction",
"UF (2)",
"UF (4)",
"UF (5)",
"UF (10)",
"UF (RSD)",
"Percentile (16th)",
"RRFlow",
"RRF<1",
"Machine Learning"
)
plot_data$Method <- factor(plot_data$Method, levels = method_levels)
ggplot(plot_data, aes(x = Method, y = Rate, fill = Type)) +
geom_bar(stat = "identity", position = position_dodge(width = 0.9), alpha = 0.8) +
geom_errorbar(aes(ymin = pmax(0, Rate - SD), ymax = Rate + SD),
position = position_dodge(width = 0.9), width = 0.2) +
labs(
title = "Comparison of GC-MS Correction Methods",
subtitle = "Conc. Uniform distribution (around AET), RRF bootstrapped data from CLAP list",
y = "Rate (%)",
x = "Method") +
geom_text(aes(label = sprintf("%.1f%%", Rate)), position = position_dodge(width = 0.9), hjust = -0.5, size = 3, vjust = 0.1) +
scale_fill_manual(values = c("False Negative" = "red", "False Positive" = "grey")) +
scale_y_continuous(limits = c(0, 100)) +
theme_minimal() +
coord_flip()
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_points <- N_sim * N_extractables
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_extractables, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_extractables, replace = FALSE)
## alpha) No Correction
corrected_conc <- base_conc_sim * simulated_RRF
total_FN <- total_FN + sum((base_conc_sim > AET) & (corrected_conc < AET))
total_FP <- total_FP + sum((base_conc_sim < AET) & (corrected_conc > AET))
}
summary_table <- rbind(summary_table, data.frame(
Method = "No Correction",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
FP_SD = sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FN_Lower = FN_Rate_final - 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FN_Upper = FN_Rate_final + 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FP_Lower = FP_Rate_final - 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FP_Upper = FP_Rate_final + 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points)
))
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_points <- N_sim * N_extractables
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_extractables, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_extractables, replace = FALSE)
## alpha) No Correction
corrected_conc <- base_conc_sim * simulated_RRF
total_FN <- total_FN + sum((base_conc_sim > AET) & (corrected_conc < AET))
total_FP <- total_FP + sum((base_conc_sim < AET) & (corrected_conc > AET))
}
FN_Rate_final <- total_FN / total_points
FP_Rate_final <- total_FP / total_points
summary_table <- rbind(summary_table, data.frame(
Method = "No Correction",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
FP_SD = sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FN_Lower = FN_Rate_final - 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FN_Upper = FN_Rate_final + 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FP_Lower = FP_Rate_final - 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FP_Upper = FP_Rate_final + 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points)
))
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total <- N_sim * N_extractables
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_extractables, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_extractables, replace = FALSE)
## alpha) No Correction
corrected_conc <- base_conc_sim * simulated_RRF
total_FN <- total_FN + sum((base_conc_sim > AET) & (corrected_conc < AET))
total_FP <- total_FP + sum((base_conc_sim < AET) & (corrected_conc > AET))
}
summary_table <- rbind(summary_table, data.frame(
Method = "No Correction",
FN_Rate = total_FN / total,
FP_Rate = total_FP / total,
FN_SD = sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
FP_SD = sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FN_Lower = FN_Rate_final - 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FN_Upper = FN_Rate_final + 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FP_Lower = FP_Rate_final - 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FP_Upper = FP_Rate_final + 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points)
))
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total <- N_sim * N_extractables
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_extractables, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_extractables, replace = FALSE)
## alpha) No Correction
corrected_conc <- base_conc_sim * simulated_RRF
total_FN <- total_FN + sum((base_conc_sim > AET) & (corrected_conc < AET))
total_FP <- total_FP + sum((base_conc_sim < AET) & (corrected_conc > AET))
}
summary_table <- rbind(summary_table, data.frame(
Method = "No Correction",
FN_Rate = total_FN / total,
FP_Rate = total_FP / total,
FN_SD = sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
FP_SD = sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FN_Lower = FN_Rate_final - 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FN_Upper = FN_Rate_final + 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FP_Lower = FP_Rate_final - 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FP_Upper = FP_Rate_final + 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points)
))
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_points <- N_sim * N_extractables
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_extractables, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_extractables, replace = FALSE)
## alpha) No Correction
corrected_conc <- base_conc_sim * simulated_RRF
total_FN <- total_FN + sum((base_conc_sim > AET) & (corrected_conc < AET))
total_FP <- total_FP + sum((base_conc_sim < AET) & (corrected_conc > AET))
}
FN_Rate_final <- total_FN / total_points
FP_Rate_final <- total_FP / total_points
summary_table <- rbind(summary_table, data.frame(
Method = "No Correction",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
FP_SD = sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FN_Lower = FN_Rate_final - 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FN_Upper = FN_Rate_final + 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FP_Lower = FP_Rate_final - 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FP_Upper = FP_Rate_final + 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points)
))
AET <- 5
set.seed(123)
base_concentrations1 <- runif(100, min = 0.5 * AET, max = 2 * AET)
hist(base_concentrations1)
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_points <- N_sim * N_extractables
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_extractables, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_extractables, replace = FALSE)
## alpha) No Correction
corrected_conc <- base_conc_sim * simulated_RRF
total_FN <- total_FN + sum((base_conc_sim > AET) & (corrected_conc < AET))
total_FP <- total_FP + sum((base_conc_sim < AET) & (corrected_conc > AET))
}
FN_Rate_final <- total_FN / total_points
FP_Rate_final <- total_FP / total_points
summary_table <- rbind(summary_table, data.frame(
Method = "No Correction",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
FP_SD = sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FN_Lower = FN_Rate_final - 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FN_Upper = FN_Rate_final + 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FP_Lower = FP_Rate_final - 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FP_Upper = FP_Rate_final + 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points)
))
gc_ms <- extract_tables("dataset/GCMS.pdf", method="stream")
gc_ms
gcms_clap <- read_excel(
path = "processed_data/GCMS.xlsx",
sheet = "GC-MS")
gcms_clap_clean <- gcms_clap %>%
na.omit()
gcms_clap_clean
gcms_clap_clean$"5 µg/mL" <- as.numeric(gcms_clap_clean$"5 µg/mL")
gcms_clap_clean$"10 µg/mL" <- as.numeric(gcms_clap_clean$"10 µg/mL")
gcms_clap_clean$"20 µg/mL" <- as.numeric(gcms_clap_clean$"20 µg/mL")
hist(gcms_clap_clean$"5 µg/mL",
main = "Histogram of RRFs for GC/MS with a 5 µg/mL surrogate Concentration",
xlab = "RRF",
col = "skyblue")
hist(gcms_clap_clean$"10 µg/mL",
main = "Histogram of RRFs for GC/MS with a 10 µg/mL surrogate Concentration",
xlab = "RRF",
col = "orange")
hist(gcms_clap_clean$"20 µg/mL",
main = "Histogram of RRFs for GC/MS with a 20 µg/mL surrogate Concentration",
xlab = "RRF",
col = "red")
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_points <- N_sim * N_extractables
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_extractables, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_extractables, replace = FALSE)
## alpha) No Correction
corrected_conc <- base_conc_sim * simulated_RRF
total_FN <- total_FN + sum((base_conc_sim > AET) & (corrected_conc < AET))
total_FP <- total_FP + sum((base_conc_sim < AET) & (corrected_conc > AET))
}
FN_Rate_final <- total_FN / total_points
FP_Rate_final <- total_FP / total_points
summary_table <- rbind(summary_table, data.frame(
Method = "No Correction",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
FP_SD = sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FN_Lower = FN_Rate_final - 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FN_Upper = FN_Rate_final + 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FP_Lower = FP_Rate_final - 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FP_Upper = FP_Rate_final + 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points)
))
summary_table <- data.frame(
Method = character(),
FN_Rate = numeric(),
FP_Rate = numeric(),
FN_SD = numeric(),
FP_SD = numeric(),
CI_FN_Lower = numeric(),
CI_FN_Upper = numeric(),
CI_FP_Lower = numeric(),
CI_FP_Upper = numeric()
)
set.seed(123)
N_sim <- 10000
N_extractables <- 80
total_FN <- 0
total_FP <- 0
total_points <- N_sim * N_extractables
for (i in 1:N_sim) {
## 1) Concentration around the AET
base_conc_sim <- sample(base_concentrations1, size = N_extractables, replace = TRUE)
## A) Non-Parametric Bootstrap of the GC/MS dataset (5µg/mL)
simulated_RRF <- sample(gcms_clap_clean$"5 µg/mL", size = N_extractables, replace = FALSE)
## alpha) No Correction
corrected_conc <- base_conc_sim * simulated_RRF
total_FN <- total_FN + sum((base_conc_sim > AET) & (corrected_conc < AET))
total_FP <- total_FP + sum((base_conc_sim < AET) & (corrected_conc > AET))
}
FN_Rate_final <- total_FN / total_points
FP_Rate_final <- total_FP / total_points
summary_table <- rbind(summary_table, data.frame(
Method = "No Correction",
FN_Rate = FN_Rate_final,
FP_Rate = FP_Rate_final,
FN_SD = sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
FP_SD = sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FN_Lower = FN_Rate_final - 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FN_Upper = FN_Rate_final + 1.96 * sqrt(FN_Rate_final * (1 - FN_Rate_final) / total_points),
CI_FP_Lower = FP_Rate_final - 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points),
CI_FP_Upper = FP_Rate_final + 1.96 * sqrt(FP_Rate_final * (1 - FP_Rate_final) / total_points)
))
reticulate::repl_python()
